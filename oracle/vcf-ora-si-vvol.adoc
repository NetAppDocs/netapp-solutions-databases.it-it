---
sidebar: sidebar 
permalink: oracle/vcf-ora-si-vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: 'La soluzione fornisce una panoramica e dettagli per la distribuzione e la protezione di Oracle in VMware Cloud Foundation (VCF) con vSphere Virtual Volumes (vVols) come storage del database primario e database Oracle in una configurazione a istanza singola (SI).' 
---
= TR-4996: Distribuzione e protezione di Oracle SI in VCF con vVols
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
La soluzione fornisce una panoramica e dettagli per la distribuzione e la protezione di Oracle in VMware Cloud Foundation (VCF) con vSphere Virtual Volumes (vVols) come storage del database primario e database Oracle in una configurazione a istanza singola (SI).



== Scopo

VMware vSphere Virtual Volumes (vVols) è un framework di gestione e integrazione SAN/NAS che espone i dischi virtuali come oggetti di storage nativi e consente operazioni basate su array a livello di disco virtuale.  In altre parole, vVols rende i dispositivi SAN/NAS compatibili con le VM e offre la possibilità di sfruttare servizi dati basati su array con un approccio incentrato sulle VM, con la granularità di un singolo disco virtuale. vVols consente ai clienti di sfruttare le capacità uniche dei loro attuali investimenti in storage e di passare senza interruzioni a un modello operativo più semplice ed efficiente, ottimizzato per ambienti virtuali che funzionano su tutti i tipi di storage.

Questa documentazione illustra la distribuzione e la protezione di un database Oracle a istanza singola in un ambiente VMware Cloud Foundation con vVols come storage del database primario in un cluster di storage NetApp ONTAP .  Il database Oracle è configurato come se fosse distribuito nei file system locali su un sistema di archiviazione locale.  Questo rapporto tecnico si concentra sui passaggi per la creazione vVols in VCF per la distribuzione Oracle.  Mostreremo inoltre come utilizzare lo strumento NetApp SnapCenter UI per eseguire il backup, il ripristino e la clonazione di un database Oracle per lo sviluppo/test o altri casi d'uso per operazioni di database efficienti in termini di storage in VCF.

Questa soluzione affronta i seguenti casi d'uso:

* Distribuzione del database Oracle SI in VCF con datastore vVols su NetApp ONTAP AFF come storage del database primario
* Backup e ripristino del database Oracle in VCF con datastore vVols utilizzando lo strumento NetApp SnapCenter UI
* Clone del database Oracle per sviluppo/test o altri casi d'uso in VCF con datastore vVols utilizzando lo strumento NetApp SnapCenter UI




== Pubblico

Questa soluzione è destinata alle seguenti persone:

* Un DBA che desidera distribuire Oracle in VCF con datastore vVols su NetApp ONTAP AFF come storage di database primario
* Un architetto di soluzioni di database che desidera testare i carichi di lavoro Oracle in VCF con datastore vVols sullo storage NetApp ONTAP AFF
* Un amministratore di storage che desidera distribuire e gestire un database Oracle distribuito su VCF con datastore vVols su storage NetApp ONTAP AFF
* Un proprietario di un'applicazione che vorrebbe creare un database Oracle in VCF con datastore vVol




== Ambiente di test e convalida della soluzione

Il test e la convalida di questa soluzione sono stati eseguiti in un ambiente di laboratorio con VCF con datastore vVols su storage NetApp ONTAP AFF che potrebbe non corrispondere all'ambiente di distribuzione finale. Per ulteriori informazioni, consultare la sezione <<Fattori chiave per la considerazione dell'implementazione>> .



=== Architettura

image:vcf-ora-si-vvols-architecture.png["Questa immagine fornisce un quadro dettagliato della configurazione di distribuzione di Oracle nel cloud pubblico AWS con iSCSI e ASM."]



=== Componenti hardware e software

[cols="33%, 33%, 33%"]
|===


3+| *Hardware* 


| NetApp ONTAP AFF A300 | Versione 9.14.1P4 | Scaffale DS224 con 24 dischi NVMe, capacità totale 35,2 TiB 


| Cluster VMware VSphere | Versione 8.02 | 12 CPU x Intel(R) Xeon(R) Gold 5218 CPU @ 2.30GHz, 8 nodi (4 di gestione e 4 domini di carico di lavoro) 


3+| *Software* 


| RedHat Linux | Kernel RHEL-8.6, 4.18.0-372.9.1.el8.x86_64 | Hosting di server Oracle DB, abbonamento RedHat distribuito per i test 


| Server Windows | Standard 2022, 10.0.20348 Build 20348 | Hosting del server SnapCenter 


| Centos Linux | CentOS Linux versione 8.5.2111 | Hosting del controller Ansible 


| Database Oracle | Versione 19.18 | Patch RU applicata p34765931_190000_Linux-x86-64.zip 


| Oracle OPatch | Versione 12.2.0.1.36 | Ultima patch p6880880_190000_Linux-x86-64.zip 


| Server SnapCenter | Versione 6.0 | Distribuzione del gruppo di lavoro 


| SnapCenter Plug-in for VMware vSphere | Versione 6.0 | Distribuito come VM ova nel cluster vSphere 


| Strumento ONTAP per VMware vSphere | Versione 9.13 | Distribuito come VM ova nel cluster vSphere 


| Apri JDK | Versione java-11-openjdk-11.0.23.0.9-3.el8.x86_64 | Requisiti del plugin SnapCenter sulle VM DB 
|===


=== Configurazione del database Oracle in VCF

[cols="33%, 33%, 33%"]
|===


3+|  


| *Server* | *Banca dati* | *Archiviazione DB* 


| ora_01 | NTAP1(NTAP1_pdb1,NTAP1_pdb2,NTAP1_pdb3) | Datastore vVols su NetApp ONTAP AFF A300 


| ora_02 | NTAP2(NTAP2_pdb1,NTAP2_pdb2,NTAP2_pdb3), NTAP1CLN | Datastore vVols su NetApp ONTAP AFF A300 
|===


=== Fattori chiave per la considerazione dell'implementazione

* *Protocollo per la connettività del cluster vVols - ONTAP .*  NFS o iSCSI sono delle buone scelte.  I livelli di prestazione sono equivalenti.  In questa dimostrazione della soluzione, abbiamo utilizzato NFS come protocollo di archiviazione per la connettività vVols al cluster di archiviazione ONTAP sottolineato.  Se l'infrastruttura VCF lo supporta, i protocolli FC/FCoE e NVMe/FC sono supportati anche per i datastore vVols su NetApp ONTAP.
* *Layout di archiviazione Oracle su datastore vVols .*  Nei nostri test e nelle nostre convalide, abbiamo distribuito tre datastore vVols per i file binari Oracle, i dati Oracle e i file di registro Oracle.  È buona norma separare i diversi tipi di file Oracle nel loro datastore, in modo che il backup, il ripristino o la clonazione del database possano essere gestiti ed eseguiti facilmente.  Crea vVols dedicati per database di grandi dimensioni e condividi vVols per database più piccoli o database con profilo QoS simile. 
* *Credenziali per l'autenticazione dell'archiviazione ONTAP .*  Utilizzare solo credenziali a livello di cluster ONTAP per l'autenticazione del cluster di archiviazione ONTAP , inclusa la connettività SnapCenter al cluster di archiviazione ONTAP o la connettività dello strumento ONTAP al cluster di archiviazione ONTAP .
* *Fornitura di spazio di archiviazione dal datastore vVols alla VM del database.*  Aggiungere solo un disco alla volta alla VM del database dal datastore vVols .  Al momento non è supportata l'aggiunta simultanea di più dischi dai datastore vVols .  
* *Protezione del database.*  NetApp fornisce una suite SnapCenter software per il backup, il ripristino e la clonazione del database con un'interfaccia utente intuitiva.  NetApp consiglia di implementare tale strumento di gestione per ottenere un backup SnapShot veloce (meno di un minuto), un ripristino rapido del database (in pochi minuti) e una clonazione del database.




== Distribuzione della soluzione

Le sezioni seguenti forniscono procedure dettagliate per la distribuzione di Oracle 19c in VCF con datastore vVols su storage NetApp ONTAP in una configurazione a istanza singola di Oracle.



=== Prerequisiti per la distribuzione

[%collapsible%open]
====
Per la distribuzione sono richiesti i seguenti prerequisiti.

. È stato configurato un VMware VCF.  Per informazioni o istruzioni su come creare un VCF, fare riferimento alla documentazione VMwarelink:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["Documentazione di VMware Cloud Foundation"^] .
. Fornire tre VM Linux, due VM per il database Oracle e una VM per il controller Ansible all'interno del dominio del carico di lavoro VCF.  Fornire una VM del server Windows per l'esecuzione del server NetApp SnapCenter .  Per informazioni sulla configurazione del controller Ansible per la distribuzione automatizzata del database Oracle, fare riferimento alle seguenti risorselink:https://docs.netapp.com/us-en/netapp-solutions-dataops/automation/getting-started.html["Introduzione all'automazione delle soluzioni NetApp ^"^] .
. Il plugin SnapCenter versione 6.0 per VMware vSphere è stato distribuito in VCF.  Per la distribuzione del plugin, fare riferimento alle seguenti risorse:link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["Documentazione SnapCenter Plug-in for VMware vSphere"^] .
. Lo strumento ONTAP per VMware vSphere è stato distribuito in VCF.  Fare riferimento alle seguenti risorse per lo strumento ONTAP per la distribuzione VMware vSphere:link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentazione ONTAP tools for VMware vSphere"^]



NOTE: Assicurati di aver allocato almeno 50 G nel volume root di Oracle VM per avere spazio sufficiente per organizzare i file di installazione di Oracle.

====


=== Crea un profilo di capacità di archiviazione

[%collapsible%open]
====
Per prima cosa, creare un profilo di capacità di archiviazione personalizzato per l'archiviazione ONTAP sottolineata che ospita il datastore vVols .

. Dai collegamenti del client vSphere, aprire lo strumento NetApp ONTAP .  Assicurarsi che il cluster di archiviazione ONTAP sia stato aggiunto a `Storage Systems` come parte dell'implementazione dello strumento ONTAP .
+
image:vcf-ora-vvol-scp-001.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."] image:vcf-ora-vvol-scp-008.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."]

. Clicca su `Storage capability profile` per aggiungere un profilo personalizzato per Oracle.  Assegna un nome al profilo e aggiungi una breve descrizione.
+
image:vcf-ora-vvol-scp-002.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."]

. Scegli la categoria del controller di archiviazione: prestazioni, capacità o ibrido.
+
image:vcf-ora-vvol-scp-003.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."]

. Selezionare il protocollo.
+
image:vcf-ora-vvol-scp-004.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."]

. Se lo si desidera, definire una policy QoS.
+
image:vcf-ora-vvol-scp-005.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."]

. Attributi di archiviazione aggiuntivi per il profilo.  Se si desidera disporre della funzionalità di crittografia, assicurarsi che la crittografia sia abilitata sul controller NetApp , altrimenti potrebbero verificarsi problemi durante l'applicazione del profilo.
+
image:vcf-ora-vvol-scp-006.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."]

. Rivedere il riepilogo e completare la creazione del profilo di capacità di archiviazione.
+
image:vcf-ora-vvol-scp-007.png["Screenshot che mostra la configurazione di un profilo di capacità di archiviazione personalizzato."]



====


=== Crea e configura il datastore vVols

[%collapsible%open]
====
Una volta completati i prerequisiti, accedi al VCF come utente amministratore tramite vSphere Client, passando al dominio del carico di lavoro.  Non utilizzare l'opzione di archiviazione VMware integrata per creare vVols.  In alternativa, utilizzare lo strumento NetApp ONTAP per creare vVols.  Di seguito vengono illustrate le procedure per creare e configurare vVols.

. Il flusso di lavoro di creazione vVols può essere attivato dall'interfaccia dello strumento ONTAP o dal cluster del dominio del carico di lavoro VCF.
+
image:vcf-ora-vvol-datastore-001.png["Screenshot che mostra la configurazione del datastore vVols ."]

+
image:vcf-ora-vvol-datastore-001-b.png["Screenshot che mostra la configurazione del datastore vVols ."]

. Inserimento di informazioni generali per l'archivio dati, tra cui destinazione di provisioning, tipo, nome e protocollo.
+
image:vcf-ora-vvol-datastore-002.png["Screenshot che mostra la configurazione del datastore vVols ."]

. Selezionare il profilo di capacità di archiviazione personalizzato creato nel passaggio precedente, il `Storage system` , E `Storage VM` , dove devono essere creati i vVols .
+
image:vcf-ora-vvol-datastore-003.png["Screenshot che mostra la configurazione del datastore vVols ."]

. Scegliere `Create new volumes` , compila il nome e la dimensione del volume e clicca su `ADD` Poi `NEXT` per passare alla pagina di riepilogo.
+
image:vcf-ora-vvol-datastore-004.png["Screenshot che mostra la configurazione del datastore vVols ."]

+

NOTE: Per migliorare le prestazioni, è possibile aggiungere più di un volume a un datastore vVols oppure distribuire i volumi di un datastore vVols su più nodi del controller ONTAP .

. Clic `Finish` per creare un datastore vVols per il binario Oracle.
+
image:vcf-ora-vvol-datastore-005.png["Screenshot che mostra la configurazione del datastore vVols ."]

. Ripetere le stesse procedure per creare un datastore vVols per i dati e il registro Oracle.
+
image:vcf-ora-vvol-datastore-006.png["Screenshot che mostra la configurazione del datastore vVols ."]




NOTE: Si noti che quando si clona un database Oracle, all'elenco vVols viene aggiunto un ulteriore vVols per i dati.

====


=== Crea una policy di archiviazione VM in base al profilo di capacità di archiviazione

[%collapsible%open]
====
Prima di effettuare il provisioning dello storage dal datastore vVols alla VM del database, aggiungere un criterio di storage della VM basato sul profilo di capacità di storage creato nel passaggio precedente.  Di seguito sono riportate le procedure.

. Dai menu del client vSphere, aprire `Policies and Profiles` e mettere in evidenza `VM Storage Policies` .  Clic `Create` aprire `VM Storage Policies` flusso di lavoro.
+
image:vcf-ora-vvol-vm-policy-001.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]

. Assegna un nome al criterio di archiviazione della VM.
+
image:vcf-ora-vvol-vm-policy-002.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]

. In `Datastore specific rules` , controllo `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf-ora-vvol-vm-policy-003.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]

. Per le regole NetApp.clustered.Data.ONTAP ONTAP `Placement` , seleziona il profilo di capacità di archiviazione personalizzato creato nel passaggio precedente.
+
image:vcf-ora-vvol-vm-policy-004.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]

. Per le regole NetApp.clustered.Data.ONTAP ONTAP `Replication` , scegliere `Disabled` se i vVols non vengono replicati.
+
image:vcf-ora-vvol-vm-policy-004-a.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]

. La pagina di compatibilità dell'archiviazione mostra i datastore vVols compatibili nell'ambiente VCF.
+
image:vcf-ora-vvol-vm-policy-005.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]

. Rivedere e terminare la creazione del criterio di archiviazione della VM.
+
image:vcf-ora-vvol-vm-policy-006.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]

. Convalidare la policy di archiviazione della VM appena creata.
+
image:vcf-ora-vvol-vm-policy-007.png["Screenshot che mostra la configurazione dei criteri di archiviazione di una macchina virtuale."]



====


=== Assegnare i dischi alla VM DB dagli archivi dati vVols e configurare l'archiviazione DB

[%collapsible%open]
====
Dal client vSphere, aggiungi tre dischi dai datastore vVols alla VM del database modificando le impostazioni della VM.  Quindi, accedi alla VM per formattare e montare i dischi sui punti di montaggio /u01, /u02 e /u03.  Di seguito sono illustrati i passaggi e le attività esatti.

. Aggiungere un disco alla VM per l'archiviazione binaria Oracle.
+
image:vcf-ora-vvol-vm-bins.png["Screenshot che mostra la configurazione di archiviazione di una macchina virtuale."]

. Aggiungere un disco alla VM per l'archiviazione dei dati Oracle.
+
image:vcf-ora-vvol-vm-data.png["Screenshot che mostra la configurazione di archiviazione di una macchina virtuale."]

. Aggiungere un disco alla macchina virtuale per l'archiviazione dei log Oracle.
+
image:vcf-ora-vvol-vm-logs.png["Screenshot che mostra la configurazione di archiviazione di una macchina virtuale."]

. Da VM `Edit Settings` , `Advanced Parameters` , aggiungi attributo `disk.enableuuid` con valore `TRUE` .  Per aggiungere il parametro avanzato, la macchina virtuale deve essere inattiva.  Impostando questa opzione, SnapCenter può identificare con precisione il vVol nel tuo ambiente.
+
image:vcf-ora-vvol-vm-uuid.png["Screenshot che mostra la configurazione di archiviazione di una macchina virtuale."]

. Ora riavvia la macchina virtuale.  Accedi alla VM come utente amministratore tramite ssh per esaminare le unità disco appena aggiunte.
+
....
[admin@ora_01 ~]$ sudo fdisk -l

Disk /dev/sdb: 50 GiB, 53687091200 bytes, 104857600 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdc: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdd: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

.
.
.
....
. Partizionare le unità come partizione primaria e singola accettando semplicemente le scelte predefinite.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
+
[source, cli]
----
sudo fdisk /dev/sdc
----
+
[source, cli]
----
sudo fdisk /dev/sdd
----
. Formattare i dischi partizionati come file system xfs.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdc1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdd1
----
. Montare le unità sui punti di montaggio /u01, /u02 e /u03.
+
[source, cli]
----
sudo mount -t xfs /dev/sdb1 /u01
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdc1 /u02
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdd1 /u03
----
+
....
[admin@ora_01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G     0  7.7G   0% /dev
tmpfs                  7.8G     0  7.8G   0% /dev/shm
tmpfs                  7.8G  782M  7.0G  10% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   19G   26G  43% /
/dev/sda1             1014M  258M  757M  26% /boot
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000
/dev/sdb1               50G  390M   50G   1% /u01
/dev/sdc1              100G  746M  100G   1% /u02
/dev/sdd1              100G  746M  100G   1% /u03

....
. Aggiungere punti di montaggio a /etc/fstab in modo che le unità disco vengano montate al riavvio della macchina virtuale.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
/dev/sdc1               /u02                    xfs     defaults        0 0
/dev/sdd1               /u03                    xfs     defaults        0 0
....


====


=== Distribuzione del database Oracle in VCF

[%collapsible%open]
====
Si consiglia di sfruttare il toolkit di automazione NetApp per distribuire Oracle in VCF con vVols.  Per informazioni dettagliate sull'esecuzione della distribuzione automatizzata di Oracle sui file system xfs, fare riferimento a TR-4992:link:../automation/automation-ora-c-series-nfs.html["Distribuzione Oracle semplificata e automatizzata su NetApp C-Series con NFS"^] .  Sebbene TR-4992 copra la distribuzione Oracle automatizzata su NetApp C-Series con NFS, è identica alla distribuzione Oracle in VCF con vVols se si bypassano i file system NFS montati sulla VM del database.  Semplicemente salteremmo questa fase con tag specifici.  Di seguito sono riportate le procedure passo passo.

. Accedi alla VM del controller Ansible come utente amministratore tramite SSH e clona una copia del toolkit di automazione per Oracle su NFS.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_nfs.git
----
. Mettere in fase i seguenti file di installazione di Oracle nella cartella /tmp/archive sulla VM del database.  La cartella dovrebbe consentire l'accesso a tutti gli utenti con autorizzazione 777.
+
....
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Configurare il file di destinazione della distribuzione (host), il file delle variabili globali (vars/vars.yml) e il file delle variabili della VM del database locale (host_vars/host_name.yml) secondo le istruzioni in questa sezione di TR-4992:link:../automation/automation-ora-c-series-nfs.html#parameter-files-configuration["Configurazione dei file dei parametri"^] .  Commentare la variabile nfs_lif dal file delle variabili della VM del database locale.
. Imposta l'autenticazione senza chiave SSH tra il controller Ansible e le VM del database, che richiede la generazione di una coppia di chiavi SSH e la copia della chiave pubblica nella directory radice dell'utente amministratore delle VM del database, nella cartella .ssh e nel file authorized_keys.
+
[source, cli]
----
ssh-keygen
----
. Dal controller Ansible, clona la directory home del toolkit di automazione /home/admin/na_oracle_deploy_nf, esegui il playbook dei prerequisiti.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Eseguire il playbook di configurazione di Linux.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Eseguire il playbook di distribuzione Oracle.
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. Facoltativamente, tutti i playbook sopra indicati possono essere eseguiti anche da un'unica esecuzione del playbook.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. Accedi a EM express per convalidare Oracle dopo l'esecuzione corretta del playbook.
+
image:vcf-ora-vvol-em-002.png["Screenshot che mostra la configurazione di Oracle EM Express."] image:vcf-ora-vvol-em-001.png["Screenshot che mostra la configurazione di Oracle EM Express."]

. Facoltativamente, eseguire destroy playbook per rimuovere il database dalla DB VM.
+
[source, cli]
----
ansible-playbook -i hosts 5-destroy.yml -u admin -e @vars/vars.yml
----


====


=== Backup, ripristino e clonazione di Oracle in VCF con SnapCenter



==== Configurazione SnapCenter

[%collapsible%open]
====
La versione 6 SnapCenter presenta numerosi miglioramenti rispetto alla versione 5, tra cui il supporto per il datastore VMware vVols .  SnapCenter si basa su un plug-in lato host su una macchina virtuale del database per eseguire attività di gestione della protezione dei dati basate sulle applicazioni.  Per informazioni dettagliate sul plug-in NetApp SnapCenter per Oracle, fare riferimento a questa documentazionelink:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Cosa puoi fare con il plug-in per Oracle Database"^] .  Di seguito sono riportati i passaggi principali per configurare SnapCenter versione 6 per il backup, il ripristino e la clonazione del database Oracle in VCF.

. Scarica la versione 6 del SnapCenter software dal sito di supporto NetApp :link:https://mysupport.netapp.com/site/downloads["Download del supporto NetApp"^] .
. Accedi come amministratore allo SnapCenter che ospita la VM Windows.  Installare i prerequisiti per SnapCenter 6.0.
+
image:vcf-ora-vvol-snapctr-prerequisites.png["Screenshot che mostra i prerequisiti SnapCenter 6.0."]

. Come amministratore, installa l'ultimo Java JDK dalink:https://www.java.com/en/["Ottieni Java per le applicazioni desktop"^] .
+

NOTE: Se il server Windows è distribuito in un ambiente di dominio, aggiungere un utente di dominio al gruppo di amministratori locali del server SnapCenter ed eseguire l'installazione SnapCenter con l'utente di dominio.

. Accedi all'interfaccia utente SnapCenter tramite la porta HTTPS 8846 come utente di installazione per configurare SnapCenter per Oracle.
+
image:vcf-ora-vvol-snapctr-deploy-001.png["Screenshot che mostra la configurazione SnapCenter ."]

. Revisione `Get Started` menu per essere aggiornato su SnapCenter se sei un nuovo utente.
+
image:vcf-ora-vvol-snapctr-deploy-002.png["Screenshot che mostra la configurazione SnapCenter ."]

. Aggiornamento `Hypervisor Settings` in contesti globali.
+
image:aws-ora-fsx-vmc-snapctr-001.png["Screenshot che mostra la configurazione SnapCenter ."]

. Aggiungi cluster di archiviazione ONTAP a `Storage Systems` con IP di gestione del cluster e autenticato tramite ID utente amministratore del cluster.
+
image:vcf-ora-vvol-snapctr-deploy-006.png["Screenshot che mostra la configurazione SnapCenter ."] image:vcf-ora-vvol-snapctr-deploy-007.png["Screenshot che mostra la configurazione SnapCenter ."]

. Aggiungi database VM e plugin VM vSphere `Credential` per l'accesso SnapCenter alla VM DB e alla VM del plugin vSphere.  Le credenziali devono disporre del privilegio sudo sulle VM Linux.  È possibile creare credenziali diverse per diversi ID utente di gestione per le VM.
+
image:aws-ora-fsx-vmc-snapctr-003.png["Screenshot che mostra la configurazione SnapCenter ."]

. Aggiungere la VM del database Oracle in VCF a `Hosts` con le credenziali DB VM create nel passaggio precedente.
+
image:vcf-ora-vvol-snapctr-deploy-008.png["Screenshot che mostra la configurazione SnapCenter ."] image:vcf-ora-vvol-snapctr-deploy-009.png["Screenshot che mostra la configurazione SnapCenter ."] image:vcf-ora-vvol-snapctr-deploy-010.png["Screenshot che mostra la configurazione SnapCenter ."]

. Allo stesso modo, aggiungi il plugin NetApp VMware VM a `Hosts` con le credenziali della VM del plugin vSphere create nel passaggio precedente.
+
image:vcf-ora-vvol-snapctr-deploy-011.png["Screenshot che mostra la configurazione SnapCenter ."] image:vcf-ora-vvol-snapctr-deploy-012.png["Screenshot che mostra la configurazione SnapCenter ."]

. Infine, dopo che il database Oracle è stato scoperto sulla VM DB, torna a `Settings`-`Policies` per creare policy di backup del database Oracle.  L'ideale sarebbe creare una policy di backup separata per i registri di archivio, per consentire intervalli di backup più frequenti e ridurre al minimo la perdita di dati in caso di errore.
+
image:aws-ora-fsx-vmc-snapctr-002.png["Screenshot che mostra la configurazione SnapCenter ."]




NOTE: Assicurarsi che il nome del server SnapCenter possa essere risolto nell'indirizzo IP della VM DB e della VM del plugin vSphere.  Allo stesso modo, il nome della VM del DB e il nome della VM del plugin vSphere possono essere risolti nell'indirizzo IP del server SnapCenter .

====


==== Backup del database

[%collapsible%open]
====
SnapCenter sfrutta lo snapshot del volume ONTAP per un backup, un ripristino o una clonazione del database molto più rapidi rispetto alla metodologia tradizionale basata su RMAN.  Gli snapshot sono coerenti con l'applicazione poiché il database viene messo in modalità di backup Oracle prima di uno snapshot.

. Dal `Resources` scheda, tutti i database sulla VM vengono rilevati automaticamente dopo che la VM è stata aggiunta a SnapCenter.  Inizialmente, lo stato del database viene visualizzato come `Not protected` .
+
image:vcf-ora-vvol-snapctr-bkup-001.png["Screenshot che mostra la configurazione SnapCenter ."]

. Fare clic sul database per avviare un flusso di lavoro per abilitare la protezione del database.
+
image:vcf-ora-vvol-snapctr-bkup-002.png["Screenshot che mostra la configurazione SnapCenter ."]

. Applicare criteri di backup e, se necessario, impostare la pianificazione.
+
image:vcf-ora-vvol-snapctr-bkup-003.png["Screenshot che mostra la configurazione SnapCenter ."]

. Se necessario, impostare la notifica del processo di backup.
+
image:vcf-ora-vvol-snapctr-bkup-005.png["Screenshot che mostra la configurazione SnapCenter ."]

. Rivedere il riepilogo e terminare per abilitare la protezione del database.
+
image:vcf-ora-vvol-snapctr-bkup-006.png["Screenshot che mostra la configurazione SnapCenter ."]

. Il processo di backup su richiesta può essere attivato facendo clic su `Back up Now` .
+
image:vcf-ora-vvol-snapctr-bkup-007.png["Screenshot che mostra la configurazione SnapCenter ."] image:vcf-ora-vvol-snapctr-bkup-008.png["Screenshot che mostra la configurazione SnapCenter ."]

. Il processo di backup può essere monitorato al `Monitor` scheda cliccando sul lavoro in esecuzione.
+
image:vcf-ora-vvol-snapctr-bkup-009.png["Screenshot che mostra la configurazione SnapCenter ."]

. Fare clic sul database per rivedere i set di backup completati per ciascun database.
+
image:vcf-ora-vvol-snapctr-bkup-010.png["Screenshot che mostra la configurazione SnapCenter ."]



====


==== Ripristino/recupero del database

[%collapsible%open]
====
SnapCenter offre numerose opzioni di ripristino e recupero per i database Oracle dal backup snapshot.  In questo esempio, mostriamo come ripristinare da un backup snapshot precedente, quindi eseguire il rollforward del database all'ultimo log disponibile.

. Per prima cosa, esegui un backup snapshot.  Quindi, crea una tabella di prova e inserisci una riga nella tabella per convalidare il database recuperato dall'immagine snapshot prima che la creazione della tabella di prova la ripristini.
+
....
[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Jul 17 10:20:10 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1;

SQL> select * from test;

no rows selected


SQL> insert into test values (1, sysdate, 'test oracle backup/restore/clone on VMware Cloud Foundation vVols');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....
. Da SnapCenter `Resources` scheda, aprire la pagina della topologia di backup del database NTAP1.  Evidenzia il set di backup dei dati snapshot prima della creazione della tabella di test.  Clicca su `Restore` per avviare il flusso di lavoro di ripristino-recupero.
+
image:vcf-ora-vvol-snapctr-restore-001.png["Screenshot che mostra la configurazione SnapCenter ."]

. Selezionare l'ambito di ripristino.
+
image:vcf-ora-vvol-snapctr-restore-002.png["Screenshot che mostra la configurazione SnapCenter ."]

. Scegli l'ambito di ripristino per `All Logs` .
+
image:vcf-ora-vvol-snapctr-restore-003.png["Screenshot che mostra la configurazione SnapCenter ."]

. Specificare eventuali pre-script facoltativi da eseguire.
+
image:vcf-ora-vvol-snapctr-restore-004.png["Screenshot che mostra la configurazione SnapCenter ."]

. Specificare eventuali script successivi facoltativi da eseguire.
+
image:vcf-ora-vvol-snapctr-restore-005.png["Screenshot che mostra la configurazione SnapCenter ."]

. Se lo desideri, invia un rapporto sul lavoro.
+
image:vcf-ora-vvol-snapctr-restore-006.png["Screenshot che mostra la configurazione SnapCenter ."]

. Rivedi il riepilogo e clicca su `Finish` per avviare il restauro e il recupero.
+
image:vcf-ora-vvol-snapctr-restore-007.png["Screenshot che mostra la configurazione SnapCenter ."]

. Da `Monitor` scheda, apri il lavoro per rivedere i dettagli.
+
image:vcf-ora-vvol-snapctr-restore-008.png["Screenshot che mostra la configurazione SnapCenter ."]

. Da DB VM ora_01, convalidare che un ripristino/recupero riuscito del database abbia riportato il suo stato più recente e recuperato la tabella di prova.
+
....

[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 11:42:58 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP1     READ WRITE

SQL> alter session set container=ntap1_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....


====


==== Clonazione del database

[%collapsible%open]
====
In questo esempio, i set di backup più recenti vengono utilizzati per clonare un database sulla VM DB ora_02 in un'installazione software diversa e ORACLE_HOME in VCF.

. Aprire nuovamente l'elenco di backup del database NTAP1.  Selezionare il set di backup dei dati più recente, fare clic su `Clone` pulsante per avviare il flusso di lavoro di clonazione del database.
+
image:vcf-ora-vvol-snapctr-clone-001.png["Screenshot che mostra la configurazione SnapCenter ."]

. Assegnare un nome al SID del database clone.
+
image:vcf-ora-vvol-snapctr-clone-002.png["Screenshot che mostra la configurazione SnapCenter ."]

. Selezionare ora_02 in VCF come host clone del database di destinazione.  Sull'host avrebbe dovuto essere installato e configurato un software di database Oracle identico.
+
image:vcf-ora-vvol-snapctr-clone-003.png["Screenshot che mostra la configurazione SnapCenter ."]

. Selezionare l'ORACLE_HOME, l'utente e il gruppo corretti sull'host di destinazione.  Mantieni le credenziali predefinite.
+
image:vcf-ora-vvol-snapctr-clone-004.png["Screenshot che mostra la configurazione SnapCenter ."]

. È possibile modificare i parametri del database clone per soddisfare i requisiti di configurazione o di risorse del database clone.
+
image:vcf-ora-vvol-snapctr-clone-005.png["Screenshot che mostra la configurazione SnapCenter ."]

. Scegli l'ambito di ripristino. `Until Cancel` recupera il clone fino all'ultimo file di registro disponibile nel set di backup.
+
image:vcf-ora-vvol-snapctr-clone-006.png["Screenshot che mostra la configurazione SnapCenter ."]

. Rivedi il riepilogo e avvia il processo di clonazione.
+
image:vcf-ora-vvol-snapctr-clone-008.png["Screenshot che mostra la configurazione SnapCenter ."]

. Monitorare l'esecuzione del lavoro di clonazione da `Monitor` scheda.
+
image:vcf-ora-vvol-snapctr-clone-009.png["Screenshot che mostra la configurazione SnapCenter ."]

. Il database clonato viene immediatamente registrato in SnapCenter.
+
image:vcf-ora-vvol-snapctr-clone-010.png["Screenshot che mostra la configurazione SnapCenter ."]

. Da DB VM ora_02, convalidare il database clonato ed eseguire una query sulla tabella di prova.
+
....
[oracle@ora_02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 12:06:48 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP1CLN  READ WRITE           ARCHIVELOG

SQL> select instance_name, host_name from v$instance;

INSTANCE_NAME
----------------
HOST_NAME
----------------------------------------------------------------
NTAP1CLN
ora_02


SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1
  2  ;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>

....


Questo completa la dimostrazione del backup, del ripristino e della clonazione del database Oracle in VCF SnapCenter .

====


== Dove trovare ulteriori informazioni

Per saperne di più sulle informazioni descritte nel presente documento, consultare i seguenti documenti e/o siti web:

* link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["Fondazione VMware Cloud"^]
* link:https://docs.netapp.com/us-en/snapcenter/["Documentazione SnapCenter software"^]

